<!DOCTYPE html>
<html>
  <head>
    <title>查询玩家信息</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  </head>
  <body>
  	<div style="padding:10px">
	<div class="easyui-panel" title="" style="width:100%">
		<div style="padding:10px">
	    <form id="queryPlayerForm" method="post" style="height:auto">
	    	服务器:<input class="easyui-combobox" id="queryPlayerZoneCombo" data-options="
					data:allZone,
					valueField:'id',
					textField:'name',
					panelHeight:'auto',
					loadFilter:zoneFilter,
					onLoadSuccess:selectQueryPlayerFirstZone
				">
	    	查询类型:<select id="queryPlayerQueryType" class="easyui-combobox" style="width:100px;">
	    					<option value=-1 selected>全服</option>
							<option value=0>玩家账号</option>
							<option value=1>昵称</option>
						</select>
			关键字:<input id="queryPlayerKeyWord" class="easyui-textbox" type="text" >			
	    	<a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-search" onclick="submitQueryPlayerForm()" style="width:80px">查询</a>
	    </form>
	    </div>
	<table id="queryPlayerGrid"  class="easyui-datagrid" title="查询结果" style="width:100%;height:auto"
			data-options="singleSelect:true,collapsible:false,loadMsg:'数据加载中请稍后……',pagination: true,rownumbers: true">
		<thead>
			<tr>
				<th data-options="field:'playerId',width:100">玩家账号</th>
				<th data-options="field:'nickName',width:100">昵称</th>
				<th data-options="field:'vipLevel',width:60,align:'center'">VIP等级</th>
				<th data-options="field:'level',width:60,align:'center'">等级</th>
				<th data-options="field:'payGold',width:60,align:'center'">充值元宝</th>
				<th data-options="field:'bindingGold',width:60,align:'center'">绑定元宝</th>
				<th data-options="field:'silver',width:100,align:'center'">银币</th>
				<th data-options="field:'power',width:60,align:'center'">体力</th>
				<th data-options="field:'regTime',width:120">注册时间</th>
				<th data-options="field:'wuJiangs',width:120,formatter:formatShowWuJiang">武将</th>
			</tr>
		</thead>
	</table>
	</div>
	<div id="queryPlayerWuJiangWindow" class="easyui-window" title="武将详细信息" data-options="modal:true,closed:true,minimizable:false,maximizable:false,collapsible:false" style="width:650px;height:400px;padding:10px;">
			<table id="wujiangGrid" class="easyui-datagrid" title="" style="width:600px;height:auto"
					data-options="
						singleSelect: true,
						collapsible:true,
					">
				<thead>
					<tr>
						<th data-options="field:'name'" width="25%">名称</th>
						<th data-options="field:'level'" width="25%">等级</th>
						<th data-options="field:'star'" width="25%">星级</th>
						<th data-options="field:'fight'" width="25%">战斗力</th>
					</tr>
				</thead>
			</table>	
		</div>
	<script>
		$(function(){
			loadAllZone();
		});
		
		function selectQueryPlayerFirstZone(){
			var data = $("#queryPlayerZoneCombo").combobox('getData');
			$("#queryPlayerZoneCombo").combobox('select',data[0].id);
		}
		
		function submitQueryPlayerForm(){
			if($('#queryPlayerQueryType').combobox('getValue') == -1){
				$.messager.confirm("提示", "确定查询全服玩家吗？", function (sure) {
			        if(sure){
			        	submitQueryPlayer();
			        }
			    });
			}else{
				submitQueryPlayer();
			}
		}
		
		function submitQueryPlayer(){
			var data = {
				zones : [$('#queryPlayerZoneCombo').combobox('getValue')],
				queryType : $('#queryPlayerQueryType').combobox('getValue'),
				keyWord : $('#queryPlayerKeyWord').val().trim(),
			};
		    $('#queryPlayerForm').form('submit', submit('QueryPlayerInfo',data,
				function () {  
                    if($('#queryPlayerQueryType').combobox('getValue') != -1 && $("#queryPlayerKeyWord").val().trim()==""){
                        showWarningF("请输入关键字",function(){
                            $("#queryPlayerKeyWord").focus();
                        });
                        return false;
                    }
                },function (result) {
			        $('#queryPlayerGrid').datagrid({loadFilter:pagerFilter}).datagrid({data: result});
			    }    
            ));  
		}
		
		function showWuJiangWindow(index){
			$('#queryPlayerGrid').datagrid('selectRow',index);
		    var row = $('#queryPlayerGrid').datagrid('getSelected');
		    $('#queryPlayerWuJiangWindow').window('open');
		    var data = {total:row.wuJiangs.length,rows:row.wuJiangs};
		    $('#wujiangGrid').datagrid('loadData',{total:row.wuJiangs.length,rows:row.wuJiangs});
		}
		
		function formatShowWuJiang(val, row, index){
			return '<a href="#" onclick="showWuJiangWindow(\''+index+'\')">查看武将详细信息</a>';
		}
	</script>
	</div>
  </body>
</html>
